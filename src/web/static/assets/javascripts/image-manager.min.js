var ImageManager=function(b,a){a=a||{};if(!a.url_current_images){$.error("url_current_images is missing")}if(!a.url_delete_image){$.error("url_delete_image is missing")}this.options=$.extend({},this.defaults,a);this.element=$(b);this.options.delete_image_request_data=a.delete_image_request_data||{};if(this.options.refresh_on_init){this.refreshImages()}};ImageManager.prototype={constructor:ImageManager,options:{},callback:null,defaults:{request_method:"POST",request_data_type:"html",image_identifier_xhr_field:"filename",image_identifier_tag:"data-image-file",image_list_item_selector:".image-list-item",delete_confirmation_message:"Do you really want to delete this image? ",refresh_on_init:true,b_sortable:null,remove_btn_selector:"a"},updateOptions:function(a){for(option_id in a){option_data=a[option_id];this.options[option_id]=option_data}this.refreshImages()},handleImages:function(){var a=this;var c=$(this.element).find(this.options.image_list_item_selector);var b=this.options.remove_btn_selector;$(c).each(function(d){$(this).find(b).unbind("click");var e=this;$(this).find(b).click(function(){a.deleteImageByElement(e);return false})});if(a.options.callback){a.options.callback()}},deleteImageByElement:function(d){var a="img["+this.options.image_identifier_tag+"]";var e=$(d).find(a);var f=$(e).attr(this.options.image_identifier_tag);x=confirm(this.options.delete_confirmation_message+"("+f+")");if(!x){return false}var c={};c[this.options.image_identifier_xhr_field]=f;if(this.options.b_sortable){if(this.options.temp_image_ordering_field){c.temp_image_ordering=this.options.b_sortable.get_items_string_old()}}var b=$.extend(this.options.delete_image_request_data,c);$.ajax({context:this,type:this.options.request_method,url:this.options.url_delete_image,data:b,dataType:this.options.request_data_type,success:function(g){$(this.element).html(g);this.handleImages()},error:function(g){console.warn(g)}});return false},refreshImagesWithHtml:function(a){$(this.element).html(a);this.handleImages()},refreshImages:function(){var b={};if(this.options.b_sortable&&this.options.temp_image_ordering_field){b.temp_image_ordering=this.options.b_sortable.get_items_string_old()}var a=$.extend(this.options.delete_image_request_data,b);this.handleImages();$.ajax({context:this,type:this.options.request_method,url:this.options.url_current_images,data:a,dataType:this.options.request_data_type,success:function(c){$(this.element).html(c);this.handleImages()},error:function(c){console.warn(c)}})}};